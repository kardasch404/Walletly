<!-- Transactions Page -->
<div id="transactions" class="page-view <%= currentPage === 'transactions' ? 'active' : '' %> p-8">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h2 class="serif text-4xl font-semibold text-[#2C2C2C] mb-2">Transactions</h2>
      <p class="text-[#2C2C2C]/60">Track and manage all your financial transactions</p>
    </div>
    <button onclick="openTransactionModal()" class="btn-primary px-6 py-3 rounded-xl text-sm font-medium">
      <i class="fas fa-plus mr-2"></i>
      Add Transaction
    </button>
  </div>

  <!-- Debug Info -->
  <div style="background: yellow; padding: 10px; margin: 10px;">
    <p>Debug Info:</p>
    <p>Categories: <%= typeof categories !== 'undefined' ? categories.length : 'undefined' %></p>
    <p>Transactions: <%= typeof transactions !== 'undefined' ? transactions.length : 'undefined' %></p>
    <% if (typeof categories !== 'undefined' && categories.length > 0) { %>
      <p>First category: <%= categories[0].name %></p>
    <% } %>
  </div>

  <!-- Transaction List -->
  <div class="card rounded-2xl p-6">
    <div class="space-y-1">
      <% if (transactions && transactions.length > 0) { %>
        <% transactions.forEach(transaction => { %>
          <div class="transaction-row flex items-center justify-between py-4 px-4 rounded-xl">
            <div class="flex items-center gap-4">
              <div class="category-icon bg-red-50">
                <i class="fas fa-tag text-red-600"></i>
              </div>
              <div>
                <p class="font-medium text-[#2C2C2C]"><%= transaction.category_name || 'No Category' %></p>
                <p class="text-sm text-[#2C2C2C]/40"><%= new Date(transaction.transactionDate).toLocaleDateString() %></p>
              </div>
            </div>
            <div class="flex items-center gap-6">
              <span class="px-3 py-1 rounded-lg bg-purple-50 text-purple-600 text-xs font-medium"><%= transaction.type %></span>
              <p class="font-semibold text-[#2C2C2C] text-lg"><%= transaction.type === 'income' ? '+' : '-' %>$<%= transaction.amount %></p>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-[#4A6B5C]/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-receipt text-[#4A6B5C] text-2xl"></i>
          </div>
          <h3 class="text-xl font-semibold text-[#2C2C2C] mb-2">No transactions yet</h3>
          <p class="text-[#2C2C2C]/60 mb-6">Add your first transaction to start tracking your finances</p>
          <button onclick="openTransactionModal()" class="btn-primary px-6 py-3 rounded-xl text-sm font-medium">
            <i class="fas fa-plus mr-2"></i>
            Add Transaction
          </button>
        </div>
      <% } %>
    </div>
  </div>
</div>

<!-- Simple Transaction Modal -->
<div id="transactionModal" style="display: none !important; position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; background: rgba(0,0,0,0.8) !important; z-index: 9999 !important;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 500px; max-width: 90%;">
    <h3 style="margin: 0 0 20px 0; font-size: 24px; color: #2C2C2C;">Add Transaction</h3>
    
    <form action="/transactions" method="POST">
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Category</label>
        <!-- Debug: Categories in modal: <%= typeof categories !== 'undefined' ? categories.length : 'undefined' %> -->
        <select name="category_id" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
          <option value="">Select category</option>
          <% if (categories && categories.length > 0) { %>
            <% categories.forEach(category => { %>
              <option value="<%= category.id %>"><%= category.name %></option>
            <% }) %>
          <% } else { %>
            <option value="">No categories found</option>
          <% } %>
        </select>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 500;">Amount ($)</label>
          <input type="number" name="amount" step="0.01" min="0" required 
                 style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" 
                 placeholder="0.00">
        </div>
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 500;">Type</label>
          <select name="type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            <option value="">Select type</option>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
          </select>
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Description</label>
        <textarea name="description" rows="3" 
                  style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; resize: none;" 
                  placeholder="Enter transaction description"></textarea>
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Transaction Date</label>
        <input type="date" name="transactionDate" required 
               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" 
               value="<%= new Date().toISOString().split('T')[0] %>">
      </div>
      
      <div style="display: flex; justify-content: flex-end; gap: 10px;">
        <button type="button" onclick="closeTransactionModal()" 
                style="padding: 10px 20px; border: 1px solid #ddd; background: white; border-radius: 8px; cursor: pointer;">
          Cancel
        </button>
        <button type="submit" 
                style="padding: 10px 20px; background: #4A6B5C; color: white; border: none; border-radius: 8px; cursor: pointer;">
          Add Transaction
        </button>
      </div>
    </form>
  </div>
</div>

<script>
function openTransactionModal() {
  var modal = document.getElementById('transactionModal');
  if (modal) {
    modal.style.display = 'block';
    modal.style.visibility = 'visible';
    modal.style.opacity = '1';
    modal.style.zIndex = '9999';
  } else {
    alert('Modal element not found!');
  }
}

function closeTransactionModal() {
  var modal = document.getElementById('transactionModal');
  modal.style.display = 'none';
  modal.style.visibility = 'hidden';
  modal.style.opacity = '0';
}
</script>
